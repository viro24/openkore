macro logAmounts {
$invHerbs = @invamount (White Herb); $invEB = @invamount (Empty Bottle); $invWP = @invamount (White Potion);
$cHerbs = @cartamount (White Herb); $cEB = @cartamount (Empty Bottle); $cWP = @cartamount (White Potion);
log $.hour:$.minute:$.second: Inv: $invHerbs WH / $invEB EB / $invWP WP
log $.hour:$.minute:$.second: Cart: $cHerbs WH / $cEB EB / $cWP WP
}

macro checkBuySteps {
$weightWP = 15; $weightEB = 2; $weightWH = 7; $weightAvailable = @eval($.maxweight-$.weight);
    switch ($weightAvailable) {
        case (>= 8000) {
		$amountHerbs = @eval(1000-@invamount (White Herb)); $amountBottles = @eval(500-@invamount (Empty Bottle));
		do talknpc 213 121 b b2,$amountHerbs b7,$amountBottles
		do talk @npc(213 121) cancel
        }
		case (>= 7000) {
		if ($cHerbs != 1000) {
		$amountHerbs = @eval(1000-@invamount (White Herb)); $amountBottles = @eval(500-@invamount (Empty Bottle));
		do talknpc 213 121 b b2,$amountHerbs
		do talk @npc(213 121) cancel
		do cart add White Herb 1000
		pause 1
		do talknpc 213 121 b b7,$amountBottles
		do talk @npc(213 121) cancel
		do cart add Empty Bottle 500
		}
		$amountHerbs = @eval(850-@invamount (White Herb)); $amountBottles = @eval(425-@invamount (Empty Bottle));
		do talknpc 213 121 b b2,$amountHerbs b7,$amountBottles
		do talk @npc(213 121) cancel
        }
    }
}

macro start-potions {
$zeitAnfang = $.time; $zenyAnfang = $.zeny; $datumStart = $.hour:$.minute:$.second;
call logAmounts
$result = @eval(@invamount (White Potion)+@cartamount (White Potion))
$resultHerbs = @eval(@invamount (White Herb)+@cartamount (White Herb))
if ($result > 0) goto ok 
if ($resultHerbs >= 2000) goto startMix 
# call hasAgi
call move-to-alch
log Vorm Einkauf
call logAmounts
call buy-herbs
log nach erster Einkaufsrunde
call logAmounts
call move-herbs-cart
log nach cart move
call logAmounts
call buy-herbs
log nach zweiter Einkaufsrunde
call logAmounts
# if (@cartamount (White Herb) <= 1000) call move-herbs-cart
# if (@invamount (White Herb) <= 1000) call buy-herbs
 :startMix
call move-to-mix
# if (@invamount (Empty Bottle) >= 1000) do cart add Empty Bottle 500
log angekommen beim Mixer
call talk-to-mix
log nachm Mixen 1
call logAmounts
call wp
log nachm cart move
call logAmounts
call talk-to-mix
log nachm Mixen 2
call logAmounts
 :ok
call move-to-alch
# if (@cartamount (White Potion) > 0) call get-potions
call get-potions
log vorm Verkauf
call logAmounts
call sell-potions-alch
log nachm Verkauf 1
call logAmounts
# if (@cartamount (White Potion) > 0) call get-potions
call get-potions
# if (@invamount (White Herb) < 1000) call sell-potions-alch
call sell-potions-alch
log nachm Verkauf 2
call logAmounts
log ----------------------------------
$resultZeit = @eval($.time-$zeitAnfang); $resultZeny = @eval($.zeny-$zenyAnfang)
log Durchlaufzeit: $resultZeit s -- Umsatz: $resultZeny
log Anfang: $datumStart -- Ende: $.datetime
log Anfangsgeld: $zenyAnfang Geldjetzt: $.zeny
log ----------------------------------
}

macro buy-herbs {
    # $amountHerbs = @eval(1000-@invamount (White Herb))
    # $amountBottles = @eval(500-@invamount (Empty Bottle))
	# $.maxweight
	# do talknpc 213 121 b b2,$amountHerbs b7,$amountBottles
	# do talk @npc(213 121) cancel
	call checkBuySteps
}

macro sell-potions-alch {
	do talknpc 213 121 s
	call sell-potions
	do talk @npc(213 121) cancel
}

macro move-to-alch {
$hl = @npc(213 121)
if ($hl < 0) {
 do c @go yuno
}
do move 202 107 yuno
}

macro move-herbs-cart {
	do cart add White Herb 1000
	do cart add Empty Bottle 500
}

macro move-to-mix {
	#do c @go alberta
    do p @go 1
	pause 0.5
	do move 160 83 morocc
	pause 0.5
	do talknpc 160 97 r2 r2
	pause 0.5
	do move 24 29 alberta_in
}

macro talk-to-mix {
	do talknpc 16 28 r0 r3 r0 n
}

macro wp {
log storing whitepots loop
 $i = 1
 $amount = @eval($i*30)
  $amount2 = @eval($i*15)
  	if (@invamount (Empty Bottle) >= 1000) {
	do cart add Empty Bottle 500
}
    while (@invamount (White Potion) > 0 || @cartamount (Empty Bottle) != 0 || @cartamount (White Herb) != 0) as loop
    [
	if (@invamount (White Herb) < 1000) {
	do cart get White Herb 50
	}
	# do cart add White Potion 25;
	if (@invamount (Empty Bottle) < 500) {
	do cart get Empty Bottle 50
}
	if (@invamount (White Potion) > 0) {
	do cart add White Potion 25
 	}
	]
    $i++
    end loop
log storing whitepots end
}

macro get-potions {
do cart get White Potion
}

macro move-pront {
$hl = @npc(143 93)
if ($hl < 0) {
 do c @go 0
}
do move 150 107 prontera
}

macro move-alb {
$hl = @npc(38 245)
if ($hl < 0) {
 do c @go alberta
}
do move 50 240 alberta
}

macro sell-potions-pront {
	do talknpc 137 97 s
	call sell-potions
}

macro sell-potions {
	do sell @inventory(White Potion)
	pause 1
	do sell done
}

macro talk-healer {
do talknpc 143 93 n
}

macro repeat {
 $durchlauf = 0
 $maxDurchlauf = 100
    while ($durchlauf < $maxDurchlauf) as loop
    log Durchlauf  $durchlauf von $maxDurchlauf
	call start-potions
    $durchlauf++
    end loop
	log Ende 
}

macro hasAgi {
if (existsInList("$.status", "Increase Agility") == 0) {
call move-pront
call talk-healer
}
}

sub existsInList {
  my ($list, $val) = @_;
  return 0 if ($val eq "");
  my @array = split / *, */, $list;
  $val = lc($val);
  foreach (@array) {
     s/^\s+//;
     s/\s+$//;
     s/\s+/ /g;
     next if $_ eq "";
     return 1 if lc eq $val;
  }
  return 0;
}

automacro perfectlyHidden {
console /Found perfectly hidden Player/
#Musashi #Lucano #Erukano
run-once 1
call {
	log GM wurde gesehen
	do quit
}
timeout 20
}
																																		